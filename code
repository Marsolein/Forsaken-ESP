local player = game.Players.LocalPlayer
local screenGui = Instance.new('ScreenGui')
screenGui.ResetOnSpawn = false
screenGui.Parent = player.PlayerGui
script.Parent = screenGui
local ESP = false

local players = game.Workspace:WaitForChild('Players')
local map = game.Workspace:WaitForChild('Map')
local uis = game:GetService('UserInputService')

local function ESPCheck(target)
	local char = target
	local tag = char:FindFirstChild('ESP')
	if tag then
		return tag
	else
		return false
	end
end

local survivorColors = {
	['Shedletsky'] = Color3.fromRGB(229,216,0), -- yellow
	['Noob'] = Color3.fromRGB(151,199,27), --
	['Elliot'] = Color3.fromRGB(176, 255, 176), --
	['Dusekkar'] = Color3.fromRGB(8,12,190), -- navy blue
	['Chance'] = Color3.fromRGB(255, 255, 255), -- white
	['Taph'] = Color3.fromRGB(255,55,59), --
	['Builderman'] = Color3.fromRGB(255,185,0), --
	['007n7'] = Color3.fromRGB(153,217,234), --
	['TwoTime'] = Color3.fromRGB(118, 118, 118), --
	['Guest1337'] = Color3.fromRGB(135, 106, 66), -- camo green
}
local killerColors = {
	['1x1x1x1'] = Color3.fromRGB(0,255,0), -- straight green
	['Noli'] = Color3.fromRGB(140, 0, 255), -- pure purple
	['Jason'] = Color3.fromRGB(128,64,0), -- brown
	['c00lkidd'] = Color3.fromRGB(255,0,0), -- red
	['JohnDoe'] = Color3.fromRGB(155,0,0)
}
local itemColors = {
	['Generator'] = Color3.fromRGB(0,255,0),
	['FakeGenerator'] = Color3.fromRGB(255, 0, 0),
	['Medkit'] = Color3.fromRGB(255, 142, 249),
	['BloxyCola'] = Color3.fromRGB(255, 170, 0)
}
--local start = player.Character.PrimaryPart.Position
			--local ending = v.Character.PrimaryPart.Position
			--local distance = (ending - start).Magnitude
			--if distance < 300 then

function ESPinitiate()
	for _, v in pairs(players.Survivors:GetChildren()) do
		if v == player.Character then
			continue
		end
		local check = ESPCheck(v)
		if not check then
			local highlight = Instance.new('Highlight')
			highlight.Name = 'ESP'
			highlight.Parent = v
			highlight.FillColor = survivorColors[v.Name]
		end
	end
	for	_, v in pairs(players.Killers:GetChildren()) do
		if v == player.Character then
			continue
		end
		local check = ESPCheck(v)
		if not check then
			local highlight = Instance.new('Highlight')
			highlight.Name = 'ESP'
			highlight.Parent = v
			highlight.FillColor = Color3.fromRGB(255,0,0)
		end
	end
	local ingame = map.Ingame
	local ingameMap = ingame:FindFirstChild('Map')
	if ingameMap then
		for _, v in pairs(ingameMap:GetChildren()) do
			if v.Name == 'Generator' then
				local check = ESPCheck(v)
				if not check then
					local highlight = Instance.new('Highlight')
					highlight.Name = 'ESP'
					highlight.Parent = v
					highlight.FillColor = itemColors[v.Name]
				end
			end
			if v.Name == 'FakeGenerator' then
				local check = ESPCheck(v)
				if not check then
					local highlight = Instance.new('Highlight')
					highlight.Name = 'ESP'
					highlight.Parent = v
					highlight.FillColor = itemColors[v.Name]
				end
			end
			if v:IsA('Tool') then
				local check = ESPCheck(v)
				if not check then
					local highlight = Instance.new('Highlight')
					highlight.Name = 'ESP'
					highlight.Parent = v
					highlight.FillColor = itemColors[v.Name]
				end
			end
		end
	end
end

function ESPDeact()
	for _, v in pairs(players.Survivors:GetChildren()) do
		local check = ESPCheck(v)
		if check then
			check:Destroy()
		end
	end
	for _, v in pairs(players.Killers:GetChildren()) do
		local check = ESPCheck(v)
		if check then
			check:Destroy()
		end
	end
	local ingame = map.Ingame
	local ingameMap = ingame:FindFirstChild('Map')
	if ingameMap then
		for _, v in pairs(ingameMap:GetChildren()) do
			if v.Name == 'Generator' then
				local check = ESPCheck(v)
				if check then
					check:Destroy()
				end
			end
			if v.Name == 'FakeGenerator' then
				local check = ESPCheck(v)
				if check then
					check:Destroy()
				end
			end
		end
		for _, v in pairs(ingame:GetChildren()) do
			if v:IsA('Tool') then
				local check = ESPCheck(v)
				if check then
					check:Destroy()
				end
			end
		end
	end
end


uis.InputBegan:Connect(function(input, gameProcessed)
	if not gameProcessed and input.KeyCode == Enum.KeyCode.P then
		ESP = not ESP
	end
end)

game:GetService("RunService").RenderStepped:Connect(function()
	if ESP then
		ESPinitiate()
	else
		ESPDeact()
	end
end)
